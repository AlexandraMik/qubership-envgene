# ATP Parameter Management

- [ATP Parameter Management](#atp-parameter-management)
  - [Terms](#terms)
  - [Problem Statement](#problem-statement)
  - [Use Cases](#use-cases)
  - [Object Model](#object-model)
  - [Proposed Approach](#proposed-approach)
    - [Option 1. Shared Template and Instance Repositories (Customer and QA Teams)](#option-1-shared-template-and-instance-repositories-customer-and-qa-teams)
      - [\[Option 1\] Requirements to EnvGene](#option-1-requirements-to-envgene)
  - [Open Questions](#open-questions)

## Terms

**Effective Set** - A structured set of configuration parameters generated by EnvGene for a specific consumer (in this case - ATP)  
**Template Repository** - Contains common parameters for all solution instances  
**Instance Repository** - Contains environment-specific parameters for a particular instance  

## Problem Statement

ATP as a system that tests Customer's Environments (Solution Instances) requires parameters related to these Environments and their supporting infrastructure.

Maintaining duplicate copies of these parameters across different configuration management (CM) systems:

- Necessitates additional CM overhead
- Increases operational costs through redundant effort
- Introduces risks of:
  - Human errors in configuration
  - Configuration drift (when identical parameters become desynchronized across CMs)

## Use Cases

List of use cases that need to be supported:

1. Onboarding ATP into existing Customer's EnvGene repositories
2. Generation of ATP-specific parameter set (Effective Set)
   1. Without encryption of sensitive parameters
   2. With encryption of sensitive parameters
3. Adding/Modifying/Removing parameters in ATP-specific parameter set (Effective Set)
   1. Parameters defined exclusively by ATP QA team
   2. Parameters defined by Customer's team

## Object Model

TBD

## Proposed Approach

Since EnvGene repositories contain:

- Inventory of Customer's Environments
- Parameters describing Customer's Solution Instances
- Parameters describing Cloud/clusters

It is proposed to use EnvGene to generate ATP-required parameters based on both:

- Customer-defined parameters
- QA team-maintained ATP-specific parameters

### Option 1. Shared Template and Instance Repositories (Customer and QA Teams)

1. ATP-specific parameters are stored in Customer's Template and Instance repositories as [ParameterSet](https://github.com/Netcracker/qubership-envgene/blob/feature/es_impovement_step_2/docs/envgene-objects.md#parameterset)
2. QA team owns and manages ATP-specific parameters
3. QA team makes changes to ATP-specific ParameterSet via Merge Request, which is approved by Customer's team
4. Paramsets are associated with Cloud E2E parameters - both in Template and Instance repositories
5. ATP-specific parameters are generated by EnvGene as consumer-specific part of pipeline context [Effective Set](https://github.com/Netcracker/qubership-envgene/blob/feature/es_impovement_step_2/docs/calculator-cli.md#version-20-effective-set-structure)
6. The structure of consumer-specific Effective Set is defined by JSON schema passed via [`EFFECTIVE_SET_CONFIG`](https://github.com/Netcracker/qubership-envgene/blob/feature/es_impovement_step_2/docs/instance-pipeline-parameters.md#effective_set_config) pipeline launch attribute or registered in EnvGene
7. ATP triggers Effective Set generation for specific Environment, the generated Effective Set is saved in Instance repository
8. ATP retrieves Effective Set for a specific Environment via contract path from Customer's Instance repository

![Option 1. Shared Template and Instance repositories](/docs/images/atp-option-1.drawio.png)

#### [Option 1] Requirements to EnvGene

1. Generation of ATP-specific context must modify only this context without affecting other Effective Set contexts

## Open Questions

1. What should the model for ATP-specific context in Effective Set look like?
2. How to split QA team-maintained ATP-specific parameters between Template and Instance repositories?
3. Are parameters in Customer's repository sufficient for ATP parameter generation?
   1. Is discovery of parameters from external systems needed (similar to cloud passport discovery)?
4. How to ensure Requirement 1 is met?
